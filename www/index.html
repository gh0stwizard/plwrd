<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="plwrd - Perl Web Run Daemon">
  <meta name="keywords" content="application, runner, perl, knockout">
  <meta name="author" content="gh0stwizard">
  <meta charset="utf-8">
  <title>plwrd &part; Application Manager &forall;</title>
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <script type="text/javascript" src="/js/knockout-3.3.0.js"></script>
  <script type="text/javascript" src="/js/zepto.min.js"></script>
</head>
<style type="text/css">

/* 
 * http://www.smashingmagazine.com/2008/08/13/top-10-css-table-designs/
 */

#one-column-emphasis {
	font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
	font-size: 1.0em;
	margin-top: 45px;
	width: 100%;
  max-width: 800px;
	text-align: left;
	border-collapse: collapse;
}
#one-column-emphasis th {
	font-size: 1.2em;
	font-weight: normal;
	padding: 12px 15px;
	color: #039;
}
#one-column-emphasis td {
	padding: 10px 15px;
	color: #669;
	border-top: 1px solid #e8edff;
	cursor: default;
}
#one-column-emphasis tr:hover td {
	color: #339;
	background: #eff2ff;
}


</style>
<body>
    <table id="one-column-emphasis" data-bind="with: chosenListAppsData" align="center">
      <thead>
        <tr>
          <th>Name</th>
          <th>Command</th>
        </tr>
      </thead>
      <tbody data-bind="foreach: $data">
        <tr data-bind="click: $root.goToApp">
          <td data-bind="text: name"></td>
          <td data-bind="text: cmd"></td>
        </tr>
      </tbody>
    </table>

  <div class="viewApp" data-bind="with: chosenAppData">
    <div class="appInfo">
      <p><label>Name</label>: <span data-bind="text: name"></span></p>
      <p><label>Command</label>: <span data-bind="text: name"></span></p>
    </div>
  </div>
</body>
<script>
  var ra = window.location.protocol + '//' + window.location.host + '/plwrd?';
  
  function sortByName( a, b ) {
    return ( a.name == b.name ) ? 0 : ( a.name < b.name ? -1 : 1 );
  }

  function AppViewModel() {
    var self = this;
  
    // Data

    self.chosenListAppsData = ko.observableArray();
    self.chosenAppData = ko.observable();
  
    // Behaviours
  
    self.goToApp = function ( app ) {
      self.chosenListAppsData( null );
      $.get( ra + 'action=getApp&name=' + app.name, self.chosenAppData );
    };
  
    ko.computed( function () {
      $.getJSON( ra + 'action=listApps', function( data, status, xhr ) {
        self.chosenListAppsData( data );
        self.chosenListAppsData.sort( sortByName );
      } );
    }, self );
  }

  ko.applyBindings( new AppViewModel() );
</script>
</html>
